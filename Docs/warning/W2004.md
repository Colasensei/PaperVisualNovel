# W2004 - 存档可能损坏

## 代码信息

- **代码**: `W2004`
- **类型**: 警告
- **等级**: WARNING
- **描述**: 存档文件格式不正确或内容损坏

## 含义

此警告表示引擎在读取存档文件时遇到格式问题或无效数据。存档可能部分损坏，引擎会尝试恢复可用数据。

## 触发条件

- 存档文件缺少必要的 `[SAVE_INFO]` 部分
- 存档文件中的 `current_line` 不是有效数字
- 存档文件缺少 `save_time` 字段
- 反序列化游戏状态时发生异常
- 无法获取存档文件大小

## 示例输出

```
[2024-01-01 12:00:00] WARNING [W2004] Invalid current_line value: abc, using 0
[2024-01-01 12:00:00] WARNING [W2004] Save file missing save_time field: Novel/HelloWorld/saves/autosave.sav
[2024-01-01 12:00:00] WARNING [W2004] Cannot get save file size: Access denied
```

## 控制台输出

```
ERROR [W2004] SaveError: Save file may be corrupted
       Hint: Try starting a new game or delete the corrupted save file
       See: https://github.com/Colasensei/PaperVisualNovel/tree/master/Docs/errors/W2004.md
```

## 解决方案

1. 删除损坏的存档文件，开始新游戏
2. 如果有备份存档，尝试恢复
3. 检查磁盘错误和文件权限
4. 确保游戏正常退出，避免强制关闭导致存档损坏

## 相关代码

- [I1002](I1002.md) - 游戏加载成功
- [I1003](I1003.md) - 游戏保存成功
- [E3004](E3004.md) - 文件打开失败
